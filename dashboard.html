<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõçÔ∏è Dashboard - API E-commerce</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #667eea;
            --primary-dark: #5a6fd8;
            --secondary: #764ba2;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
            --light: #f8f9fa;
            --dark: #343a40;
            --gray: #6c757d;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--dark);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px;
        }

        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .api-status {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .stat-card .number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--dark);
            display: block;
        }

        .stat-card .label {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-3px);
        }

        .card h2 {
            color: var(--dark);
            margin-bottom: 25px;
            border-bottom: 3px solid var(--primary);
            padding-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card h2 i {
            color: var(--primary);
        }

        .btn-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: scale(1.05);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            opacity: 0.9;
            transform: scale(1.05);
        }

        .btn-warning {
            background: var(--warning);
            color: var(--dark);
        }

        .btn-warning:hover:not(:disabled) {
            opacity: 0.9;
            transform: scale(1.05);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            opacity: 0.9;
            transform: scale(1.05);
        }

        .btn-info {
            background: var(--info);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover:not(:disabled) {
            background: var(--primary);
            color: white;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 12px;
        }

        .user-info {
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 5px solid var(--primary);
        }

        .user-info.hidden {
            display: none;
        }

        .token-display {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            word-break: break-all;
            color: #856404;
        }

        .result {
            background: var(--light);
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
            border-left: 5px solid var(--primary);
            max-height: 400px;
            overflow-y: auto;
        }

        .result.success {
            border-left-color: var(--success);
        }

        .result.error {
            border-left-color: var(--danger);
        }

        .result.warning {
            border-left-color: var(--warning);
        }

        .result pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.4;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .product-card {
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            background: white;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }

        .product-card:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            transform: translateY(-3px);
        }

        .product-name {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--dark);
            margin-bottom: 10px;
        }

        .product-price {
            color: var(--success);
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .product-description {
            color: var(--gray);
            font-size: 0.9rem;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .product-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }

        .product-category {
            background: var(--primary);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .product-stock {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .stock-low {
            color: var(--danger);
            font-weight: bold;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--primary);
        }

        .loading i {
            font-size: 2rem;
            margin-bottom: 15px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        .order-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .order-card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .order-id {
            font-weight: bold;
            color: var(--dark);
        }

        .order-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-pending { background: #fff3cd; color: #856404; }
        .status-processing { background: #cce7ff; color: #004085; }
        .status-shipped { background: #d1ecf1; color: #0c5460; }
        .status-delivered { background: #d4edda; color: #155724; }
        .status-cancelled { background: #f8d7da; color: #721c24; }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-total {
            padding: 20px;
            background: var(--light);
            border-radius: 8px;
            margin-top: 20px;
            font-size: 1.2rem;
            font-weight: bold;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: var(--success);
        }

        .notification.error {
            background: var(--danger);
        }

        .notification.info {
            background: var(--info);
        }

        .notification.warning {
            background: var(--warning);
            color: var(--dark);
        }

        @media (max-width: 768px) {
            .btn-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
            
            .products-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .debug-info {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-size: 12px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-shopping-cart"></i> Dashboard E-commerce</h1>
            <p>Sistema completo de API com PHP, MySQL e JWT Authentication</p>
            
            <div class="api-status">
                <div id="apiStatus" class="btn btn-outline">
                    <i class="fas fa-circle"></i> Verificando API...
                </div>
            </div>
            
            <div class="stats">
                <div class="stat-card" onclick="listarProdutos()">
                    <i class="fas fa-box"></i>
                    <span class="number" id="productsCount">0</span>
                    <span class="label">Produtos</span>
                </div>
                <div class="stat-card" onclick="listarCategorias()">
                    <i class="fas fa-tags"></i>
                    <span class="number" id="categoriesCount">0</span>
                    <span class="label">Categorias</span>
                </div>
                <div class="stat-card" onclick="listarPedidos()">
                    <i class="fas fa-shopping-bag"></i>
                    <span class="number" id="ordersCount">0</span>
                    <span class="label">Pedidos</span>
                </div>
                <div class="stat-card" onclick="testarLogin()">
                    <i class="fas fa-users"></i>
                    <span class="number" id="usersCount">-</span>
                    <span class="label">Usu√°rios</span>
                </div>
            </div>
        </div>

        <div class="main-content">
            <!-- Coluna Principal -->
            <div class="main-column">
                <!-- Card de Autentica√ß√£o -->
                <div class="card">
                    <h2><i class="fas fa-lock"></i> Autentica√ß√£o JWT</h2>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="testarRegistro()">
                            <i class="fas fa-user-plus"></i> Registrar Usu√°rio
                        </button>
                        <button class="btn btn-success" onclick="testarLogin()">
                            <i class="fas fa-sign-in-alt"></i> Fazer Login
                        </button>
                        <button class="btn btn-warning" onclick="testarPerfil()">
                            <i class="fas fa-user"></i> Meu Perfil
                        </button>
                        <button class="btn btn-danger" onclick="limparSessao()">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                    <div id="userInfo" class="user-info hidden">
                        <strong><i class="fas fa-user-check"></i> Usu√°rio Logado:</strong>
                        <span id="userEmail"></span> (<span id="userRole"></span>)
                        <div class="token-display">
                            <strong>Token JWT:</strong> <span id="tokenPreview"></span>
                        </div>
                    </div>
                </div>

                <!-- Card de Produtos -->
                <div class="card">
                    <h2><i class="fas fa-box"></i> Gest√£o de Produtos</h2>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="listarProdutos()">
                            <i class="fas fa-list"></i> Listar Produtos
                        </button>
                        <button class="btn btn-success" onclick="listarCategorias()">
                            <i class="fas fa-tags"></i> Listar Categorias
                        </button>
                        <button class="btn btn-info" onclick="buscarProdutos()">
                            <i class="fas fa-search"></i> Buscar Produtos
                        </button>
                        <button class="btn btn-warning" onclick="criarProdutoDemo()">
                            <i class="fas fa-plus"></i> Criar Produto
                        </button>
                    </div>
                    <div id="productsResult">
                        <div class="loading hidden" id="productsLoading">
                            <i class="fas fa-spinner"></i>
                            <p>Carregando produtos...</p>
                        </div>
                    </div>
                </div>

                <!-- Card de Pedidos -->
                <div class="card">
                    <h2><i class="fas fa-shopping-bag"></i> Sistema de Pedidos</h2>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="listarPedidos()">
                            <i class="fas fa-list"></i> Meus Pedidos
                        </button>
                        <button class="btn btn-success" onclick="criarPedidoDemo()">
                            <i class="fas fa-cart-plus"></i> Novo Pedido
                        </button>
                        <button class="btn btn-info" onclick="verCarrinho()">
                            <i class="fas fa-shopping-cart"></i> Ver Carrinho
                        </button>
                    </div>
                    <div id="ordersResult">
                        <div class="loading hidden" id="ordersLoading">
                            <i class="fas fa-spinner"></i>
                            <p>Carregando pedidos...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Card de Carrinho -->
                <div class="card">
                    <h2><i class="fas fa-shopping-cart"></i> Carrinho de Compras</h2>
                    <div id="cartItems">
                        <p style="text-align: center; color: var(--gray); padding: 20px;">
                            <i class="fas fa-cart-arrow-down"></i><br>
                            Carrinho vazio
                        </p>
                    </div>
                    <div class="cart-total">
                        Total: R$ <span id="cartTotal">0.00</span>
                    </div>
                    <button class="btn btn-success" onclick="finalizarPedido()" style="width: 100%; margin-top: 15px;">
                        <i class="fas fa-check"></i> Finalizar Pedido
                    </button>
                </div>

                <!-- Card de Testes R√°pidos -->
                <div class="card">
                    <h2><i class="fas fa-vial"></i> Testes R√°pidos</h2>
                    <div class="btn-group">
                        <button class="btn btn-outline" onclick="testarAPI()">
                            <i class="fas fa-home"></i> Status da API
                        </button>
                        <button class="btn btn-outline" onclick="testarRota('GET', '/products')">
                            <i class="fas fa-box"></i> Testar Produtos
                        </button>
                        <button class="btn btn-outline" onclick="testarRota('GET', '/categories')">
                            <i class="fas fa-tags"></i> Testar Categorias
                        </button>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-info" onclick="limparResultados()">
                            <i class="fas fa-broom"></i> Limpar Logs
                        </button>
                        <button class="btn btn-warning" onclick="debugInfo()">
                            <i class="fas fa-bug"></i> Debug Info
                        </button>
                    </div>
                </div>

                <!-- Card de Resultados -->
                <div class="card">
                    <h2><i class="fas fa-terminal"></i> Log de Atividades</h2>
                    <div id="resultado">
                        <p style="text-align: center; color: var(--gray); padding: 20px;">
                            <i class="fas fa-info-circle"></i><br>
                            Nenhuma atividade registrada
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications -->
    <div id="notification" class="notification"></div>

    <script>
        // ==================== CONFIGURA√á√ïES ====================
        const API_BASE = 'http://localhost:8000';
        let currentToken = localStorage.getItem('jwt_token');
        let currentUser = JSON.parse(localStorage.getItem('user_data') || 'null');
        let cart = JSON.parse(localStorage.getItem('cart') || '[]');
        let productsCache = [];

        // ==================== INICIALIZA√á√ÉO ====================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Inicializando Dashboard E-commerce');
            updateUserInterface();
            updateCartDisplay();
            verificarAPI();
            carregarDadosIniciais();
            
            mostrarNotificacao('Dashboard carregado com sucesso!', 'success');
        });

        // ==================== FUN√á√ïES UTILIT√ÅRIAS ====================
        function updateUserInterface() {
            const userInfo = document.getElementById('userInfo');
            const userEmail = document.getElementById('userEmail');
            const userRole = document.getElementById('userRole');
            const tokenPreview = document.getElementById('tokenPreview');

            if (currentUser && currentToken) {
                userInfo.classList.remove('hidden');
                userEmail.textContent = currentUser.email;
                userRole.textContent = currentUser.role;
                tokenPreview.textContent = currentToken.substring(0, 50) + '...';
            } else {
                userInfo.classList.add('hidden');
            }
        }

        async function makeRequest(method, endpoint, data = null) {
            const config = {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                }
            };

            if (currentToken) {
                config.headers['Authorization'] = `Bearer ${currentToken}`;
            }

            if (data) {
                config.body = JSON.stringify(data);
            }

            try {
                console.log(`üì§ ${method} ${endpoint}`, data);
                const response = await fetch(API_BASE + endpoint, config);
                const result = await response.json();
                
                return {
                    success: response.ok,
                    status: response.status,
                    data: result
                };
            } catch (error) {
                console.error('‚ùå Erro na requisi√ß√£o:', error);
                return {
                    success: false,
                    error: error.message
                };
            }
        }

        function mostrarResultado(titulo, dados, sucesso = true) {
            const resultadoDiv = document.getElementById('resultado');
            const timestamp = new Date().toLocaleTimeString();
            const tipo = sucesso ? 'success' : (dados.error ? 'error' : 'warning');
            
            // Remove mensagem inicial se existir
            if (resultadoDiv.innerHTML.includes('Nenhuma atividade')) {
                resultadoDiv.innerHTML = '';
            }
            
            resultadoDiv.innerHTML = `
                <div class="result ${tipo}">
                    <strong>${titulo}</strong> 
                    <small style="color: #666; float: right;">${timestamp}</small>
                    <pre>${JSON.stringify(dados, null, 2)}</pre>
                </div>
            ` + resultadoDiv.innerHTML;
        }

        function mostrarNotificacao(mensagem, tipo = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = mensagem;
            notification.className = `notification ${tipo} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // ==================== AUTENTICA√á√ÉO ====================
        async function testarRegistro() {
            const userData = {
                name: "Usuario " + Math.floor(Math.random() * 1000),
                email: `user${Math.floor(Math.random() * 10000)}@email.com`,
                password: "123456"
            };

            mostrarNotificacao('Registrando usu√°rio...', 'info');
            const result = await makeRequest('POST', '/auth/register', userData);
            
            if (result.success && result.data.token) {
                currentToken = result.data.token;
                currentUser = result.data.user;
                localStorage.setItem('jwt_token', currentToken);
                localStorage.setItem('user_data', JSON.stringify(currentUser));
                updateUserInterface();
                mostrarNotificacao('Usu√°rio registrado com sucesso!', 'success');
            } else {
                mostrarNotificacao(result.data.error || 'Erro no registro', 'error');
            }
            
            mostrarResultado('POST /auth/register', result.data, result.success);
        }

        async function testarLogin() {
            const loginData = {
                email: "admin@ecommerce.com",
                password: "password"
            };

            mostrarNotificacao('Fazendo login...', 'info');
            const result = await makeRequest('POST', '/auth/login', loginData);
            
            if (result.success && result.data.token) {
                currentToken = result.data.token;
                currentUser = result.data.user;
                localStorage.setItem('jwt_token', currentToken);
                localStorage.setItem('user_data', JSON.stringify(currentUser));
                updateUserInterface();
                mostrarNotificacao(`Bem-vindo, ${currentUser.name}!`, 'success');
            } else {
                mostrarNotificacao(result.data.error || 'Erro no login', 'error');
            }
            
            mostrarResultado('POST /auth/login', result.data, result.success);
        }

        async function testarPerfil() {
            if (!currentToken) {
                mostrarNotificacao('Fa√ßa login primeiro!', 'warning');
                return;
            }

            mostrarNotificacao('Buscando perfil...', 'info');
            const result = await makeRequest('GET', '/auth/profile');
            
            if (result.success) {
                mostrarNotificacao('Perfil carregado!', 'success');
            }
            
            mostrarResultado('GET /auth/profile', result.data, result.success);
        }

        function limparSessao() {
            currentToken = null;
            currentUser = null;
            localStorage.removeItem('jwt_token');
            localStorage.removeItem('user_data');
            updateUserInterface();
            mostrarNotificacao('Sess√£o encerrada!', 'info');
        }

        // ==================== PRODUTOS ====================
        async function listarProdutos() {
            document.getElementById('productsLoading').classList.remove('hidden');
            
            const result = await makeRequest('GET', '/products');
            
            if (result.success) {
                productsCache = result.data.data || [];
                const productsDiv = document.getElementById('productsResult');
                productsDiv.innerHTML = '<h3>üì¶ Produtos Dispon√≠veis</h3>';
                
                if (productsCache.length > 0) {
                    const productsGrid = document.createElement('div');
                    productsGrid.className = 'products-grid';
                    
                    productsCache.forEach(product => {
                        const productCard = document.createElement('div');
                        productCard.className = 'product-card';
                        productCard.innerHTML = `
                            <div class="product-name">${product.name}</div>
                            <div class="product-price">R$ ${product.price}</div>
                            <div class="product-description">${product.description}</div>
                            <div class="product-meta">
                                <span class="product-category">${product.category_name || 'Geral'}</span>
                                <span class="product-stock ${product.stock < 10 ? 'stock-low' : ''}">
                                    Estoque: ${product.stock}
                                </span>
                            </div>
                            <button class="btn btn-primary btn-sm" onclick="adicionarAoCarrinho(${product.id})" style="width: 100%; margin-top: 15px;">
                                <i class="fas fa-cart-plus"></i> Adicionar ao Carrinho
                            </button>
                        `;
                        productsGrid.appendChild(productCard);
                    });
                    
                    productsDiv.appendChild(productsGrid);
                    document.getElementById('productsCount').textContent = productsCache.length;
                    mostrarNotificacao(`${productsCache.length} produtos carregados!`, 'success');
                } else {
                    productsDiv.innerHTML += '<p>Nenhum produto encontrado.</p>';
                }
            }
            
            document.getElementById('productsLoading').classList.add('hidden');
            mostrarResultado('GET /products', result.data, result.success);
        }

        async function listarCategorias() {
            const result = await makeRequest('GET', '/categories?with_count=true');
            
            if (result.success) {
                document.getElementById('categoriesCount').textContent = result.data.data.length;
                mostrarNotificacao(`${result.data.data.length} categorias carregadas!`, 'success');
            }
            
            mostrarResultado('GET /categories', result.data, result.success);
        }

        async function buscarProdutos() {
            const termo = prompt('Digite o termo de busca:');
            if (termo) {
                const result = await makeRequest('GET', `/products?search=${encodeURIComponent(termo)}`);
                mostrarResultado(`Busca: "${termo}"`, result.data, result.success);
            }
        }

        async function criarProdutoDemo() {
            if (!currentToken) {
                mostrarNotificacao('Fa√ßa login como admin primeiro!', 'warning');
                return;
            }

            const productData = {
                name: "Produto Demo " + Math.floor(Math.random() * 100),
                description: "Descri√ß√£o do produto demo",
                price: (Math.random() * 100 + 10).toFixed(2),
                stock: Math.floor(Math.random() * 50),
                category_id: 1
            };

            const result = await makeRequest('POST', '/products', productData);
            
            if (result.success) {
                mostrarNotificacao('Produto criado com sucesso!', 'success');
                listarProdutos();
            }
            
            mostrarResultado('POST /products', result.data, result.success);
        }

        // ==================== FUN√á√ÉO PARA CRIAR PRODUTO (COM FALLBACK) ====================
async function criarProdutoDemo() {
    if (!currentToken) {
        mostrarNotificacao('Fa√ßa login primeiro!', 'warning');
        return;
    }

    // Verifica se o usu√°rio √© admin
    if (currentUser.role !== 'admin') {
        mostrarNotificacao('Apenas administradores podem criar produtos!', 'warning');
        
        // Fallback: Mostra formul√°rio simulado
        const productData = {
            name: "Produto Demo " + Math.floor(Math.random() * 100),
            description: "Descri√ß√£o do produto demo criado via API",
            price: (Math.random() * 100 + 10).toFixed(2),
            stock: Math.floor(Math.random() * 50),
            category_id: 1
        };

        mostrarResultado('SIMULA√á√ÉO: POST /products (apenas admin)', {
            success: true,
            message: 'Produto seria criado com sucesso (apenas para demonstra√ß√£o)',
            product_data: productData,
            note: 'Usu√°rio atual n√£o tem permiss√£o de admin para criar produtos reais'
        }, true);
        return;
    }

    // Se √© admin, cria o produto real
    const productData = {
        name: "Produto Admin " + Math.floor(Math.random() * 100),
        description: "Produto criado por administrador",
        price: (Math.random() * 100 + 10).toFixed(2),
        stock: Math.floor(Math.random() * 50),
        category_id: 1
    };

    const result = await makeRequest('POST', '/products', productData);
    
    if (result.success) {
        mostrarNotificacao('Produto criado com sucesso!', 'success');
        listarProdutos(); // Atualiza a lista
    } else {
        mostrarNotificacao(result.data.error || 'Erro ao criar produto', 'error');
    }
    
    mostrarResultado('POST /products', result.data, result.success);
}

// ==================== FUN√á√ÉO PARA VERIFICAR PERMISS√ïES ====================
function verificarPermissoes() {
    if (!currentUser) {
        return { isAdmin: false, isLoggedIn: false };
    }
    return { 
        isAdmin: currentUser.role === 'admin', 
        isLoggedIn: true,
        userRole: currentUser.role 
    };
}

// ==================== ATUALIZAR BOT√ïES COM BASE NAS PERMISS√ïES ====================
function atualizarBotoesComPermissoes() {
    const perms = verificarPermissoes();
    
    // Bot√£o de criar produto - s√≥ mostra para admin
    const criarProdutoBtn = document.querySelector('button[onclick="criarProdutoDemo()"]');
    if (criarProdutoBtn) {
        if (!perms.isAdmin) {
            criarProdutoBtn.innerHTML = '<i class="fas fa-plus"></i> Criar Produto (Apenas Admin)';
            criarProdutoBtn.disabled = true;
            criarProdutoBtn.style.opacity = '0.6';
        } else {
            criarProdutoBtn.innerHTML = '<i class="fas fa-plus"></i> Criar Produto (Admin)';
            criarProdutoBtn.disabled = false;
            criarProdutoBtn.style.opacity = '1';
        }
    }
}

        // ==================== PEDIDOS ====================
        async function listarPedidos() {
            if (!currentToken) {
                mostrarNotificacao('Fa√ßa login primeiro!', 'warning');
                return;
            }

            document.getElementById('ordersLoading').classList.remove('hidden');
            
            const result = await makeRequest('GET', '/orders');
            
            if (result.success) {
                const ordersDiv = document.getElementById('ordersResult');
                ordersDiv.innerHTML = '<h3>üìã Meus Pedidos</h3>';
                
                if (result.data.data && result.data.data.length > 0) {
                    document.getElementById('ordersCount').textContent = result.data.data.length;
                    
                    result.data.data.forEach(order => {
                        const orderCard = document.createElement('div');
                        orderCard.className = 'order-card';
                        orderCard.innerHTML = `
                            <div class="order-header">
                                <span class="order-id">Pedido #${order.id}</span>
                                <span class="order-status status-${order.status}">${order.status}</span>
                            </div>
                            <div><strong>Total:</strong> R$ ${order.total}</div>
                            <div><strong>Itens:</strong> ${order.items_count}</div>
                            <div><strong>Data:</strong> ${new Date(order.created_at).toLocaleDateString()}</div>
                            <button class="btn btn-outline btn-sm" onclick="detalhesPedido(${order.id})" style="margin-top: 10px;">
                                <i class="fas fa-eye"></i> Ver Detalhes
                            </button>
                        `;
                        ordersDiv.appendChild(orderCard);
                    });
                    
                    mostrarNotificacao(`${result.data.data.length} pedidos carregados!`, 'success');
                } else {
                    ordersDiv.innerHTML += '<p>Nenhum pedido encontrado.</p>';
                }
            }
            
            document.getElementById('ordersLoading').classList.add('hidden');
            mostrarResultado('GET /orders', result.data, result.success);
        }

        async function detalhesPedido(orderId) {
            const result = await makeRequest('GET', `/orders/${orderId}`);
            mostrarResultado(`GET /orders/${orderId}`, result.data, result.success);
        }

        // ==================== CARRINHO ====================
        function adicionarAoCarrinho(productId) {
            const product = productsCache.find(p => p.id == productId);
            if (product) {
                const existingItem = cart.find(item => item.product_id == productId);
                
                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    cart.push({
                        product_id: productId,
                        quantity: 1,
                        price: product.price,
                        name: product.name
                    });
                }
                
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCartDisplay();
                mostrarNotificacao(`${product.name} adicionado ao carrinho!`, 'success');
            }
        }

        function removerDoCarrinho(index) {
            const item = cart[index];
            cart.splice(index, 1);
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartDisplay();
            mostrarNotificacao(`${item.name} removido do carrinho!`, 'warning');
        }

        function updateCartDisplay() {
            const cartItems = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');
            
            let total = 0;
            
            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <p style="text-align: center; color: var(--gray); padding: 20px;">
                        <i class="fas fa-cart-arrow-down"></i><br>
                        Carrinho vazio
                    </p>
                `;
            } else {
                cartItems.innerHTML = '';
                
                cart.forEach((item, index) => {
                    total += item.price * item.quantity;
                    const cartItem = document.createElement('div');
                    cartItem.className = 'cart-item';
                    cartItem.innerHTML = `
                        <div>
                            <div style="font-weight: bold;">${item.name}</div>
                            <div style="font-size: 0.9rem; color: #666;">
                                R$ ${item.price} x ${item.quantity} = R$ ${(item.price * item.quantity).toFixed(2)}
                            </div>
                        </div>
                        <button class="btn btn-danger btn-sm" onclick="removerDoCarrinho(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    `;
                    cartItems.appendChild(cartItem);
                });
            }
            
            cartTotal.textContent = total.toFixed(2);
        }

        async function finalizarPedido() {
            if (!currentToken) {
                mostrarNotificacao('Fa√ßa login primeiro!', 'error');
                return;
            }

            if (cart.length === 0) {
                mostrarNotificacao('Carrinho vazio!', 'warning');
                return;
            }

            const orderData = {
                items: cart.map(item => ({
                    product_id: item.product_id,
                    quantity: item.quantity
                }))
            };

            mostrarNotificacao('Processando pedido...', 'info');
            const result = await makeRequest('POST', '/orders', orderData);
            
            if (result.success) {
                mostrarNotificacao('Pedido criado com sucesso!', 'success');
                cart = [];
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCartDisplay();
                listarPedidos();
            } else {
                mostrarNotificacao(result.data.error || 'Erro ao criar pedido', 'error');
            }
            
            mostrarResultado('POST /orders', result.data, result.success);
        }

        async function criarPedidoDemo() {
            if (!currentToken) {
                mostrarNotificacao('Fa√ßa login primeiro!', 'error');
                return;
            }

            // Primeiro carrega produtos se necess√°rio
            if (productsCache.length === 0) {
                await listarProdutos();
            }

            if (productsCache.length >= 2) {
                cart = [
                    {
                        product_id: productsCache[0].id,
                        quantity: 1,
                        price: productsCache[0].price,
                        name: productsCache[0].name
                    },
                    {
                        product_id: productsCache[1].id, 
                        quantity: 2,
                        price: productsCache[1].price,
                        name: productsCache[1].name
                    }
                ];
                
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCartDisplay();
                mostrarNotificacao('Carrinho demo criado! Adicione mais itens ou finalize o pedido.', 'success');
            }
        }

        function verCarrinho() {
            if (cart.length === 0) {
                mostrarNotificacao('Carrinho vazio!', 'info');
            } else {
                mostrarNotificacao(`Carrinho com ${cart.length} itens`, 'info');
            }
        }

        // ==================== TESTES E UTILIT√ÅRIOS ====================
        async function testarAPI() {
            const result = await makeRequest('GET', '/');
            
            if (result.success) {
                mostrarNotificacao('API online e funcionando!', 'success');
            }
            
            mostrarResultado('GET / (API Status)', result.data, result.success);
        }

        async function testarRota(method, endpoint) {
            const result = await makeRequest(method, endpoint);
            mostrarResultado(`${method} ${endpoint}`, result.data, result.success);
        }

        async function verificarAPI() {
            try {
                const response = await fetch(API_BASE + '/');
                const data = await response.json();
                
                const statusElement = document.getElementById('apiStatus');
                if (data.success) {
                    statusElement.innerHTML = '<i class="fas fa-circle" style="color: var(--success);"></i> API Online';
                    statusElement.className = 'btn btn-success';
                } else {
                    statusElement.innerHTML = '<i class="fas fa-circle" style="color: var(--danger);"></i> API Offline';
                    statusElement.className = 'btn btn-danger';
                }
            } catch (error) {
                const statusElement = document.getElementById('apiStatus');
                statusElement.innerHTML = '<i class="fas fa-circle" style="color: var(--danger);"></i> API Offline';
                statusElement.className = 'btn btn-danger';
            }
        }

        async function carregarDadosIniciais() {
            // Carrega produtos automaticamente
            const productsResult = await makeRequest('GET', '/products');
            if (productsResult.success) {
                productsCache = productsResult.data.data || [];
                document.getElementById('productsCount').textContent = productsCache.length;
            }

            // Carrega categorias
            const categoriesResult = await makeRequest('GET', '/categories');
            if (categoriesResult.success) {
                document.getElementById('categoriesCount').textContent = categoriesResult.data.data.length;
            }

            // Se estiver logado, carrega pedidos
            if (currentToken) {
                const ordersResult = await makeRequest('GET', '/orders');
                if (ordersResult.success) {
                    document.getElementById('ordersCount').textContent = ordersResult.data.data.length;
                }
            }
        }

        function limparResultados() {
            document.getElementById('resultado').innerHTML = `
                <p style="text-align: center; color: var(--gray); padding: 20px;">
                    <i class="fas fa-info-circle"></i><br>
                    Nenhuma atividade registrada
                </p>
            `;
            mostrarNotificacao('Logs limpos!', 'info');
        }

        function debugInfo() {
            const debugData = {
                timestamp: new Date().toISOString(),
                api_base: API_BASE,
                user_logged_in: !!currentUser,
                user_email: currentUser?.email,
                cart_items: cart.length,
                products_cached: productsCache.length,
                token_exists: !!currentToken
            };
            
            mostrarResultado('Debug Information', debugData, true);
        }

        // ==================== EVENT LISTENERS ====================
        document.addEventListener('keydown', function(e) {
            // Atalhos de teclado
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case '1':
                        e.preventDefault();
                        testarAPI();
                        break;
                    case '2':
                        e.preventDefault();
                        listarProdutos();
                        break;
                    case '3':
                        e.preventDefault();
                        listarPedidos();
                        break;
                    case 'l':
                        e.preventDefault();
                        limparResultados();
                        break;
                }
            }
        });

        console.log(`
    üõçÔ∏è  DASHBOARD E-COMMERCE INICIALIZADO
    ==================================
    API: ${API_BASE}
    Usu√°rio: ${currentUser ? currentUser.email : 'N√£o logado'}
    Token: ${currentToken ? 'Presente' : 'N√£o presente'}
    Produtos em cache: ${productsCache.length}
    Itens no carrinho: ${cart.length}
        `);
    </script>
</body>
</html>
